<%= video_tag video_stream_path(video._id), controls: true, autoplay: true, autobuffer: true, class: 'video-player', :data => { 'video-id' => video._id.to_s, 'next-video-path' => next_video_path } %>
<script>
    $('.video-player').on('ended', event => {
        const elem = $(event.target);
        sendEvent(elem.data('video-id'), 'video_finished', () => {
            const nextVideo = elem.data('next-video-path');
            if(nextVideo != null && nextVideo.length > 0) {
                window.location.pathname = nextVideo;
            }
        });
    });

    $('.video-player').on('loadstart', event => {
        const elem = $(event.target);
        sendEvent(elem.data('video-id'), 'video_started');
    });
</script>
