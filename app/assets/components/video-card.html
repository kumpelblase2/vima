<template id="video-card">
    <div class="column is-2">
        <div class="card" @click="onClick">
            <div class="card-image" :class="{ 'is-selected-video': selected }">
                <div class="image-overlay">
                    <img :src="selectedThumbnail()" class="image" />
                    <div class="image-overlay-content">
                        <div class="video-edit">
                            <span class="icon" @click="edit">
                                <i class="fa fa-pencil"></i>
                            </span>
                        </div>
                        <div class="video-play">
                            <span class="icon" @click="play">
                                <i class="fa fa-play"></i>
                            </span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card-header">
                <div class="card-header-title">{{ video.name }}</div>
            </div>
            <div class="card-content">
                <div class="content">
                    <div class="" v-for="key in metadata">{{ key | capitalize }}: {{ video[key] }}</div>
                </div>
            </div>
        </div>
    </div>
</template>

<script>
    Vue.component('video-card', {
        template: document.currentScript.ownerDocument.querySelector("#video-card").innerHTML,
        props: {
            id: String,
            url: String,
            metadata: Array
        },
        data: function() {
            return {
                video: {},
                loaded: false,
                selected: false
            }
        },
        methods: {
            load: function() {
                const url = this.id ? "/videos/" + this.id + ".json" : this.url;
                const self = this;
                $.ajax({
                    url: url,
                    dataType: "json",
                    success: function(response) {
                        self.loaded = true;
                        self.video = response;
                    }
                });
            },
            selectedThumbnail: function() {
                if(this.loaded && this.video.thumbnails.available.length > 0) {
                    return this.video.thumbnails.available[this.video.thumbnails.selected];
                } else {
                    return "";
                }
            },
            edit: function() {
                this.$dispatch('edit-request', this.video);
            },
            play: function() {
                this.$dispatch('play-request', this.video);
            },
            toggleSelect: function() {
                this.selected = !this.selected;
                if(this.selected) {
                    this.$dispatch('video-select', this.video);
                } else {
                    this.$dispatch('video-deselect', this.video);
                }
            },
            onClick: function(event) {
                if(event.ctrlKey) {
                    event.stopPropagation();
                    this.toggleSelect();
                }
            }
        },
        ready: function() {
            this.load();
        }
    });
</script>