<link rel="import" href="<%= asset_path('video-card.html') %>">
<link rel="import" href="<%= asset_path('video-edit-modal.html') %>">

<template id="video-list">
  <div class="columns is-multiline">
    <video-card :url="video" v-for="video in videos" :metadata.sync="metadata" @edit-request="openEdit"></video-card>
  </div>
  <video-edit-modal v-if="currentlyEditing" :video="currentlyEditing" :shown="currentlyEditing != null" @edit-finish="closeEdit"></video-edit-modal>
</template>

<script>
    Vue.component('video-list', {
        template: document.currentScript.ownerDocument.querySelector("#video-list").innerHTML,
        props: {
            metadata: Array,
            videos: Array,
            selected: {
                type: Array,
                'default': () => []
            }
        },
        data: function() {
            return {
                currentlyEditing: null
            }
        },
        methods: {
            openEdit: function(video) {
                this.currentlyEditing = video;
            },
            closeEdit: function() {
                this.currentlyEditing = null;
            }
        },
        events: {
            'video-update': function(video) {
                //TODO
            },
            'video-select': function(video) {
                this.selected.push(video);
            },
            'video-deselect': function(video) {
                const index = this.selected.findIndex((elem) => elem.id === video.id);
                if(index >= 0) {
                    this.selected.splice(index, index + 1);
                }
            }
        }
    });
</script>